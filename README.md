# xtdamo

[![Version](https://img.shields.io/badge/version-0.2.0-blue.svg)](https://github.com/sandorn/xtdamo)
[![Python](https://img.shields.io/badge/python-3.8+-blue.svg)](https://www.python.org/downloads/)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)

xtdamo æ˜¯ä¸€ä¸ªåŸºäºå¤§æ¼ æ’ä»¶(Dm) çš„ç°ä»£åŒ–å°è£…åº“ï¼Œç”¨äºè‡ªåŠ¨åŒ–æ“ä½œï¼ŒåŒ…æ‹¬çª—å£ç®¡ç†ã€é¼ æ ‡æ§åˆ¶ã€é”®ç›˜æ¨¡æ‹Ÿã€å›¾åƒè¯†åˆ«ã€æ–‡æœ¬æŸ¥æ‰¾ç­‰åŠŸèƒ½ã€‚é€‚ç”¨äºæ¸¸æˆè„šæœ¬ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€RPA ç­‰åœºæ™¯ã€‚

## âœ¨ ç‰¹æ€§äº®ç‚¹

### ğŸ—ï¸ ç°ä»£åŒ–æ¶æ„è®¾è®¡

-   **åˆ†å±‚æ¶æ„**: æ¸…æ™°çš„ `DmExcute -> ApiProxy -> CoreEngine` ä¸‰å±‚è®¾è®¡
-   **æ™ºèƒ½è·¯ç”±**: è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ–¹æ³•å®ç°ï¼Œæ— éœ€å…³å¿ƒåº•å±‚ç»†èŠ‚
-   **æ¨¡å—åŒ–**: `Key`ã€`Mouse` ç‹¬ç«‹æ¨¡å—ï¼ŒèŒè´£æ˜ç¡®
-   **å‘åå…¼å®¹**: æ”¯æŒæ—§ç‰ˆæœ¬ä»£ç æ— ç¼è¿ç§»

### ğŸ›¡ï¸ å¥å£®çš„é”™è¯¯å¤„ç†

-   **å‚æ•°éªŒè¯**: å®Œæ•´çš„å‚æ•°èŒƒå›´æ£€æŸ¥å’Œç±»å‹éªŒè¯
-   **å‹å¥½é”™è¯¯**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè¯Šæ–­å»ºè®®
-   **å¼‚å¸¸å®‰å…¨**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

### ğŸ“š å®Œæ•´çš„æ–‡æ¡£æ”¯æŒ

-   **Google Style**: æ‰€æœ‰æ–¹æ³•éƒ½æœ‰è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²
-   **ç±»å‹æ³¨è§£**: å®Œæ•´çš„ç±»å‹æç¤ºï¼ŒIDE æ™ºèƒ½æç¤ºå‹å¥½
-   **ç¤ºä¾‹ä¸°å¯Œ**: æ¯ä¸ªåŠŸèƒ½éƒ½æœ‰å®ç”¨çš„ä»£ç ç¤ºä¾‹

### ğŸš€ å¢å¼ºåŠŸèƒ½

-   **å®‰å…¨ç‚¹å‡»**: `safe_click` å¸¦éšæœºå»¶è¿Ÿï¼Œé˜²æ£€æµ‹
-   **ä¾¿åˆ©å±æ€§**: `position` å±æ€§å¿«é€Ÿè·å–/è®¾ç½®é¼ æ ‡ä½ç½®
-   **é«˜çº§æ“ä½œ**: æ”¯æŒæŒç»­æ—¶é—´çš„ç‚¹å‡»ã€æ‹–æ‹½ç­‰å¤æ‚æ“ä½œ

## ç®€ä»‹

xtdamo æä¾›äº†å¯¹å¤§æ¼ æ’ä»¶çš„é«˜çº§å°è£…ï¼Œç®€åŒ–äº†ä¸çª—å£ã€é¼ æ ‡ã€é”®ç›˜å’Œå›¾åƒè¯†åˆ«ç›¸å…³çš„æ“ä½œã€‚ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š

-   **çª—å£ç®¡ç†**: çª—å£æŸ¥æ‰¾ã€ç»‘å®šã€å±æ€§è·å–
-   **é¼ æ ‡æ“ä½œ**: ç§»åŠ¨ã€ç‚¹å‡»ã€æ‹–æ‹½ã€æ»šè½®
-   **é”®ç›˜æ¨¡æ‹Ÿ**: æŒ‰é”®ã€ç»„åˆé”®ã€æ–‡æœ¬è¾“å…¥
-   **å›¾åƒè¯†åˆ«**: å›¾åƒæŸ¥æ‰¾ã€é¢œè‰²è¯†åˆ«
-   **æ–‡æœ¬è¯†åˆ«**: æ–‡å­—æŸ¥æ‰¾ã€OCR
-   **é«˜çº§åŠŸèƒ½**: æ–‡ä»¶æ“ä½œã€æ³¨å†Œè¡¨æ“ä½œ

## å®‰è£…

### ç³»ç»Ÿè¦æ±‚

-   **Python 3.8+ (32 ä½ç‰ˆæœ¬)** - å¤§æ¼ æ’ä»¶ä»…æ”¯æŒ 32 ä½ Python ç¯å¢ƒ
-   Windows æ“ä½œç³»ç»Ÿ
-   å¤§æ¼ æ’ä»¶ï¼ˆdm.dllï¼‰

> **é‡è¦æç¤º**: å¤§æ¼ æ’ä»¶åªèƒ½åœ¨ 32 ä½ Python ç¯å¢ƒä¸‹è¿è¡Œï¼Œè¯·ç¡®ä¿ä½¿ç”¨ 32 ä½ Python ç‰ˆæœ¬ã€‚

### å®‰è£…æ–¹æ³•

1. **åˆ›å»º 32 ä½ Python è™šæ‹Ÿç¯å¢ƒ**ï¼š

```bash
# ç¡®ä¿ä½¿ç”¨32ä½Pythonåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv --python=python3.12-32  # æˆ–æŒ‡å®š32ä½Pythonè·¯å¾„
.venv\Scripts\activate  # Windows
```

2. **ä»æºç å®‰è£…**ï¼š

```bash
git clone https://github.com/sandorn/xtdamo.git
cd xtdamo
pip install -e .
```

3. **ä» PyPI å®‰è£…**ï¼ˆè®¡åˆ’ä¸­ï¼‰ï¼š

```bash
pip install xtdamo
```

> **æ³¨æ„**: è¯·ç¡®ä¿åœ¨ 32 ä½ Python ç¯å¢ƒä¸­å®‰è£…å’Œè¿è¡Œé¡¹ç›®ã€‚

### å¤§æ¼ æ’ä»¶é…ç½®

å°†å¤§æ¼ æ’ä»¶ï¼ˆdm.dllï¼‰æ”¾ç½®åœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œæˆ–é€šè¿‡ç¯å¢ƒå˜é‡æŒ‡å®šè·¯å¾„ï¼š

```bash
# è®¾ç½®å¤§æ¼ æ’ä»¶è®¤è¯ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰
set DM_REG_CODE=your_registration_code
set DM_VER_INFO=your_version_info
```

## æ¶æ„è®¾è®¡

xtdamo é‡‡ç”¨æ¸…æ™°çš„åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œç¡®ä¿ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         DmExcute (ä¸»å…¥å£)           â”‚
â”‚  - ç»Ÿä¸€çš„è°ƒç”¨æ¥å£                    â”‚
â”‚  - è‡ªåŠ¨æ–¹æ³•è·¯ç”±                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                      â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   ApiProxy     â”‚    â”‚  CoreEngine    â”‚
       â”‚  (é«˜çº§æ¥å£å±‚)   â”‚â”€â”€â”€>â”‚  (æ ¸å¿ƒå¼•æ“å±‚)   â”‚
       â”‚                â”‚    â”‚                â”‚
       â”‚ - ä¸­æ–‡å‹å¥½API   â”‚    â”‚ - åº•å±‚æ ¸å¿ƒæ–¹æ³•  â”‚
       â”‚ - æ™ºèƒ½é”™è¯¯å¤„ç†  â”‚    â”‚ - ç›´æ¥å°è£…DM   â”‚
       â”‚ - è‡ªåŠ¨æ—¥å¿—è®°å½•  â”‚    â”‚ - åŸºç¡€åŠŸèƒ½å®ç°  â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç‰¹æ€§

-   **åˆ†å±‚æ¶æ„**: æ¸…æ™°çš„å±‚æ¬¡åˆ’åˆ†ï¼ŒèŒè´£æ˜ç¡®
-   **æ™ºèƒ½è·¯ç”±**: è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å®ç°æ–¹æ³•
-   **å‘åå…¼å®¹**: ä¿æŒå¯¹æ—§ä»£ç çš„å…¼å®¹æ€§
-   **æ˜“äºæ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡ï¼Œæ–¹ä¾¿åŠŸèƒ½æ‰©å±•

æ›´å¤šæ¶æ„ç»†èŠ‚è¯·å‚è€ƒ [æ¶æ„æ›´æ–°è¯´æ˜](docs/architecture_update.md)ã€‚

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### å¿«é€Ÿå¼€å§‹

```python
from xtdamo import DmExcute

# åˆå§‹åŒ–ï¼ˆè‡ªåŠ¨æ³¨å†Œå¤§æ¼ æ’ä»¶ï¼‰
dm = DmExcute()

# æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯
print(f"ç‰ˆæœ¬: {dm.ver()}")
print(f"åº“ç‰ˆæœ¬: {dm.__version__}")  # è¾“å‡º: 0.2.0
```

### çª—å£æ“ä½œ

```python
# æŸ¥æ‰¾çª—å£
hwnd = dm.FindWindow("", "è®°äº‹æœ¬")
if hwnd == 0:
    print("æœªæ‰¾åˆ°çª—å£")
    exit(1)

# ç»‘å®šçª—å£ï¼ˆé«˜çº§æ¥å£ï¼Œå¸¦å‚æ•°éªŒè¯ï¼‰
try:
    dm.ç»‘å®šçª—å£(
        hwnd,
        display='gdi',      # æ˜¾ç¤ºæ¨¡å¼
        mouse='windows3',   # é¼ æ ‡æ¨¡å¼
        keypad='windows',   # é”®ç›˜æ¨¡å¼
        mode=101            # ç»‘å®šæ¨¡å¼
    )
    print("ç»‘å®šæˆåŠŸï¼")
except ValueError as e:
    print(f"å‚æ•°é”™è¯¯: {e}")
except AssertionError as e:
    print(f"ç»‘å®šå¤±è´¥: {e}")

# ä½¿ç”¨é»˜è®¤é…ç½®ç»‘å®šï¼ˆæ¨èï¼‰
dm.ç»‘å®šçª—å£(hwnd)  # ä½¿ç”¨é»˜è®¤å‚æ•°
```

### é¼ æ ‡æ“ä½œï¼ˆå¤šç§æ–¹å¼ï¼‰

```python
# æ–¹å¼1: é€šè¿‡ DmExcute ä¸»å…¥å£ï¼ˆè‡ªåŠ¨è·¯ç”±ï¼‰
dm.MoveTo(100, 200)        # ç§»åŠ¨é¼ æ ‡
dm.LeftClick()             # å·¦é”®ç‚¹å‡»

# æ–¹å¼2: ä½¿ç”¨ä¾¿åˆ©å±æ€§
x, y = dm.Mouse.position   # è·å–å½“å‰ä½ç½®
dm.Mouse.position = (500, 300)  # è®¾ç½®ä½ç½®

# æ–¹å¼3: ä½¿ç”¨å¢å¼ºæ–¹æ³•
dm.Mouse.safe_click(300, 400, auto_reset_pos=True)  # å®‰å…¨ç‚¹å‡»
dm.Mouse.click_left(100, 200, t=1.0)  # é•¿æŒ‰1ç§’

# æ–¹å¼4: æ‹–æ‹½æ“ä½œ
dm.Mouse.MoveTo(100, 100)
dm.Mouse.LeftDown()
dm.Mouse.MoveTo(200, 200)
dm.Mouse.LeftUp()
```

### é”®ç›˜æ“ä½œ

```python
# é€šè¿‡ DmExcute ä¸»å…¥å£
dm.KeyPressStr('Hello World')  # è¾“å…¥æ–‡æœ¬
dm.KeyPress(13)                # æŒ‰å›è½¦é”®ï¼ˆVK_RETURNï¼‰

# ä½¿ç”¨ VirtualKeys å¸¸é‡
from xtdamo.time_utils import VirtualKeys
dm.Key.KeyPress(VirtualKeys.ENTER)
dm.Key.KeyPress(VirtualKeys.ESC)

# ç»„åˆé”®æ“ä½œ
dm.Key.KeyDown(VirtualKeys.CTRL)   # æŒ‰ä¸‹Ctrl
dm.Key.KeyPress(ord('C'))          # æŒ‰Cé”®
dm.Key.KeyUp(VirtualKeys.CTRL)     # é‡Šæ”¾Ctrl

# ç­‰å¾…æŒ‰é”®
if dm.Key.WaitKey(VirtualKeys.ESC, 5000):
    print("ç”¨æˆ·æŒ‰ä¸‹äº†ESCé”®")
```

### å›¾åƒè¯†åˆ«ä¸æ“ä½œ

```python
# é«˜çº§æ¥å£ - æ‰¾å›¾å¹¶ç‚¹å‡»
success = dm.æ‰¾å›¾å•å‡»(0, 0, 1920, 1080, 'button.bmp', '000000', 0.9)
if success:
    print("æ‰¾åˆ°å¹¶ç‚¹å‡»æˆåŠŸ")

# æ‰¾å›¾ç›´åˆ°æ¶ˆå¤±
dm.æ‰¾å›¾å•å‡»è‡³æ¶ˆå¤±(0, 0, 800, 600, 'close.bmp', max_retries=10)

# è·å–åæ ‡
found, x, y = dm.æ‰¾å›¾è¿”å›åæ ‡(0, 0, 1920, 1080, 'target.bmp')
if found:
    print(f"å›¾åƒä½ç½®: ({x}, {y})")
    dm.Mouse.safe_click(x, y)
```

### æ–‡å­—è¯†åˆ«ä¸æ“ä½œ

```python
# æ‰¾å­—å¹¶ç‚¹å‡»
success = dm.æ‰¾å­—å•å‡»(0, 0, 800, 600, 'å¼€å§‹æ¸¸æˆ', 'FFFFFF', 0.9)

# ç®€æ˜“è¯†å­—
text = dm.ç®€æ˜“è¯†å­—(100, 100, 300, 200, 'FFFFFF', 0.9)
print(f"è¯†åˆ«åˆ°çš„æ–‡å­—: {text}")

# æ‰¾å­—è¿”å›åæ ‡
found, x, y = dm.æ‰¾å­—è¿”å›åæ ‡(0, 0, 800, 600, 'ç¡®å®š', 'FFFFFF', 0.9)
if found:
    dm.Mouse.MoveTo(x, y)
    dm.Mouse.LeftClick()
```

### æ™ºèƒ½æŸ¥æ‰¾ï¼ˆæ¸å¼€èºæ—‹ï¼‰

```python
# ä»ä¸­å¿ƒç‚¹å‘å¤–èºæ—‹æŸ¥æ‰¾é¼ æ ‡
found, x, y = dm.åœ†å½¢æ¸å¼€æ‰¾é¼ æ ‡(
    center_x=500,
    center_y=400,
    max_radius=200,
    pic_name='cursor.bmp'
)
if found:
    print(f"é¼ æ ‡å›¾ç‰‡ä½ç½®: ({x}, {y})")
```

### å®Œæ•´ç¤ºä¾‹ - è‡ªåŠ¨åŒ–è„šæœ¬

```python
from xtdamo import DmExcute
from xtdamo.time_utils import sleep, VirtualKeys

def main():
    # åˆå§‹åŒ–
    dm = DmExcute()
    print(f"xtdamo ç‰ˆæœ¬: {dm.__version__}")

    # æŸ¥æ‰¾å¹¶ç»‘å®šçª—å£
    hwnd = dm.FindWindow("", "ç›®æ ‡ç¨‹åº")
    if hwnd == 0:
        print("æœªæ‰¾åˆ°çª—å£")
        return

    # ç»‘å®šçª—å£ï¼ˆä½¿ç”¨é»˜è®¤é…ç½®ï¼‰
    dm.ç»‘å®šçª—å£(hwnd)
    print("çª—å£ç»‘å®šæˆåŠŸ")

    # æ‰§è¡Œè‡ªåŠ¨åŒ–ä»»åŠ¡
    try:
        # ç‚¹å‡»å¼€å§‹æŒ‰é’®
        if dm.æ‰¾å›¾å•å‡»(0, 0, 800, 600, 'start_button.bmp'):
            print("ç‚¹å‡»å¼€å§‹æŒ‰é’®æˆåŠŸ")
            sleep(1)

        # è¾“å…¥ç”¨æˆ·å
        dm.KeyPressStr('username')
        dm.KeyPress(VirtualKeys.TAB)

        # è¾“å…¥å¯†ç 
        dm.KeyPressStr('password')
        dm.KeyPress(VirtualKeys.ENTER)

        # ç­‰å¾…ç™»å½•å®Œæˆï¼ˆæ‰¾å›¾ç¡®è®¤ï¼‰
        sleep(2)
        if dm.ç®€æ˜“æ‰¾å›¾(0, 0, 800, 600, 'login_success.bmp'):
            print("ç™»å½•æˆåŠŸï¼")

    finally:
        # è§£ç»‘çª—å£
        dm.è§£ç»‘çª—å£()
        print("çª—å£å·²è§£ç»‘")

if __name__ == '__main__':
    main()
```

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç æˆ–æå‡ºå»ºè®®ï¼è¯·å‚è€ƒ [è´¡çŒ®æŒ‡å—](CONTRIBUTING.md) è·å–æ›´å¤šä¿¡æ¯ã€‚

## è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ª [MIT è®¸å¯è¯](LICENSE)ã€‚
